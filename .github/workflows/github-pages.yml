name: Deploy to GitHub Pages

on:
  push:
    branches: [ testing ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Check docs directory
      run: |
        echo "🔍 Checking docs directory..."
        if [ ! -d "docs" ]; then
          echo "❌ docs directory not found!"
          exit 1
        fi
        
        echo "📁 Found docs directory with contents:"
        ls -la docs/
        
        if [ ! -f "docs/index.html" ]; then
          echo "❌ docs/index.html not found!"
          exit 1
        fi
        
        # Check for other essential files
        required_files=("styles.css" "favicon.ico")
        for file in "${required_files[@]}"; do
          if [ ! -f "docs/$file" ]; then
            echo "⚠️  Warning: docs/$file not found"
          else
            echo "✅ Found docs/$file"
          fi
        done
        
        echo "✅ docs directory validation passed"

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './docs'

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: Deployment status
      run: |
        echo "🚀 GitHub Pages deployment completed!"
        echo "📱 Site URL: https://warpnextmanager.nightcode.co.in/"
        echo "🔗 Repository: ${{ github.repository }}"
        echo "🌿 Branch: ${{ github.ref_name }}"
        
        # Additional validation
        if [ -n "${{ steps.deployment.outputs.page_url }}" ]; then
          echo "✅ Deployment URL is available: ${{ steps.deployment.outputs.page_url }}"
        else
          echo "⚠️  Deployment URL not available, using default: https://warpnextmanager.nightcode.co.in/"
        fi 